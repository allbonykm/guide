<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìœ¨ì´ì˜ ì—­ì‚¬ì—¬í–‰: ë°”ëŠ˜ê°ì‹œì˜ ì¡°ìƒì„ ì°¾ì•„ì„œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f1f5f9; /* Slate-100 */
            color: #334155; /* Slate-700 */
            overflow: hidden;
            touch-action: manipulation;
        }

        .font-comic {
            font-family: 'Jua', sans-serif;
        }

        /* ë°”ëŠ˜ ì°Œë¥´ê¸° ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes poke-right {
            0% { transform: translateX(0) rotate(45deg); }
            50% { transform: translateX(5px) rotate(45deg); }
            100% { transform: translateX(0) rotate(45deg); }
        }
        
        @keyframes poke-left {
            0% { transform: translateX(0) rotate(-135deg); }
            50% { transform: translateX(-5px) rotate(-135deg); }
            100% { transform: translateX(0) rotate(-135deg); }
        }

        @keyframes shine {
            0% { opacity: 0.8; }
            50% { opacity: 1; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8); }
            100% { opacity: 0.8; }
        }

        .btn-next-needle {
            animation: poke-right 1.5s infinite ease-in-out;
            cursor: pointer;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.2));
        }

        .btn-prev-needle {
            animation: poke-left 1.5s infinite ease-in-out;
            cursor: pointer;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.2));
        }

        .btn-quiz {
            animation: shine 2s infinite ease-in-out;
        }

        /* í…ìŠ¤íŠ¸ ë°•ìŠ¤ - ë©”íƒˆë¦­ ì»¨ì…‰ */
        .text-box {
            background-color: rgba(255, 255, 255, 0.98);
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 20px rgba(148, 163, 184, 0.4);
            border-top: 4px solid #cbd5e1; /* Slate-300 */
        }

        /* ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ */
        .img-container {
            width: 100%;
            height: 100%;
            background-color: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .img-cover { width: 100%; height: 100%; object-fit: cover; }
        .img-fit { width: 100%; height: 100%; object-fit: contain; }

        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ìºë¦­í„° ëŒ€ì‚¬ ê°•ì¡° ìƒ‰ìƒ */
        .char-yul { color: #0ea5e9; font-weight: 700; }
        .char-needle { color: #e11d48; font-weight: 700; }
        .char-ancient { color: #57534e; font-weight: 700; }
    </style>
</head>
<body class="h-screen w-screen flex flex-col justify-center items-center bg-slate-200">

    <div id="app" class="w-full h-full max-w-md bg-white relative shadow-2xl overflow-hidden flex flex-col border-x border-slate-300">
    </div>

    <script>
        // ë°ì´í„° ì •ì˜
        const storyData = [
            {
                type: 'cover',
                image: 'images/needle0.jpg', 
                alt: 'í‘œì§€: ìœ¨ì´ì˜ ì—­ì‚¬ì—¬í–‰'
            },
            {
                type: 'intro',
                image: 'images/needle1.jpg',
                title: 'ğŸ« ë“±ì¥ì¸ë¬¼ ì†Œê°œ',
                content: `
                    <div class="space-y-3">
                        <p><span class="char-yul">ì¡°ìœ¨ (8ì‚´)</span>: ì²­ê³¡ì´ˆ 1í•™ë…„ 5ë°˜ 17ë²ˆ. í¬ë‹ˆí…Œì¼ì„ ì¢‹ì•„í•˜ê³ , 'ì•„ì”¨ë°© ì¼ê³±ë™ë¬´' ì±…ì„ ì½ë‹¤ ì ì´ ë“  í˜¸ê¸°ì‹¬ ë§ì€ ë©‹ì§„ ì†Œë…€.</p>
                        <p><span class="char-needle">ë°”ëŠ˜ê°ì‹œ</span>: ë¾°ì¡±í•œ ëª¨ìì™€ ë‚ ì”¬í•œ í—ˆë¦¬ë¥¼ ìë‘í•˜ëŠ” ê³ ìš´ í•œë³µ ì…ì€ ë°”ëŠ˜ ìš”ì •.</p>
                        <p><span class="char-ancient">ë°ë‹ˆ</span>: 5ë§Œ ë…„ ì „ ì‹œë² ë¦¬ì•„ì— ì‚¬ëŠ” ë°ë‹ˆì†Œë°”ì¸ ì¹œêµ¬.</p>
                        <p><span class="char-ancient">ì‚°ì´</span>: ìœ ëŸ½ì˜ ë†’ì€ ì‚° ë™êµ´ì— ì‚¬ëŠ” ì¹œêµ¬. í˜¸ëª¨ ì‚¬í”¼ì—”ìŠ¤.</p>
                        <p><span class="char-ancient">ëŒì´</span>: í‹°ë² íŠ¸ ê³ ì›ì— ì‚¬ëŠ” ëˆê¸° ìˆëŠ” ì¹œêµ¬.</p>
                        <p><span class="char-ancient">ë°”ë‹¤</span>: í•œêµ­ ë¶€ì‚° ë°”ë‹·ê°€ì— ì‚¬ëŠ” ì‹ ì„ê¸° ì‹œëŒ€ ì¹œêµ¬.</p>
                    </div>
                `
            },
            {
                type: 'story',
                image: 'images/needle2.jpg',
                title: '1ì¥: ë°”ëŠ˜ê°ì‹œì™€ì˜ ë§Œë‚¨',
                sub: '(ìœ¨ì´ì˜ ë°©, ì±…ì—ì„œ ë¹›ì´ ë‚˜ë©°!)',
                content: `
                    <p class="mb-2"><span class="char-yul">ìœ¨ì´:</span> "ì•„í•¨~ ë°”ëŠ˜ì€ ë¾°ì¡±í•´ì„œ ì¢‹ê² ë„¤. ê·¼ë° ì‚¬ëŒë“¤ì€ ì–¸ì œë¶€í„° ë°”ëŠ˜ì„ ì¼ì„ê¹Œ? ê³µë£¡ ì‹œëŒ€ì—ë„ ìˆì—ˆì„ê¹Œ?"</p>
                    <p class="mb-2"><span class="char-needle">ë°”ëŠ˜ê°ì‹œ:</span> (ë¿…!) "ìœ¨ì´ì•¼! ë‚˜ëŠ” í˜¸ë‘ì´ ë‹´ë°° í”¼ìš°ë˜ ì‹œì ˆë³´ë‹¤ í›¨ì”¬ ì „ë¶€í„° ìˆì—ˆë‹¨ë‹¤!"</p>
                    <p class="mb-2"><span class="char-yul">ìœ¨ì´:</span> "ìš°ì™€! ì •ë§? ë‚˜ë‘ ê°™ì´ í™•ì¸í•˜ëŸ¬ ê°€ë³¼ë˜?"</p>
                    <p><span class="char-needle">ë°”ëŠ˜ê°ì‹œ:</span> "ì¢‹ì•„! ë‚´ ì‹¤ì„ ê½‰ ì¡ì•„. 'ë”°ë”ë”°ë” ì½•ì½•' íƒ€ì„ë¨¸ì‹  ì¶œë°œ!"</p>
                `
            },
            {
                type: 'story',
                image: 'images/needle3.jpg',
                title: '2ì¥: ê½ê½ ì–¼ìŒ ë‚˜ë¼ì™€ ìƒˆ ë¼ˆ ë°”ëŠ˜',
                sub: '(5ë§Œ ë…„ ì „ ì‹œë² ë¦¬ì•„ ë°ë‹ˆì†Œë°” ë™êµ´(Denisova Cave))',
                content: `
                    <p class="mb-2"><span class="char-yul">ìœ¨ì´:</span> "ìœ¼ìœ¼~ ë„ˆë¬´ ì¶”ì›Œ! ëƒ‰ë™ì‹¤ ê°™ì•„!"</p>
                    <p class="mb-2"><span class="char-needle">ë°”ëŠ˜ê°ì‹œ:</span> "ì—¬ê¸°ëŠ” ë¹™í•˜ê¸°ì•¼. ì €ê¸° <span class='char-ancient'>ë°ë‹ˆ</span>ë¥¼ ë´. ìƒˆ ë¼ˆë¡œ ë­˜ ë§Œë“¤ê³  ìˆì–´."</p>
                    <p class="mb-2"><span class="char-ancient">ë°ë‹ˆ:</span> "ì´ ìƒˆ ë¼ˆëŠ” ì†ì´ ë¹„ì–´ì„œ ê°€ë³ê³  íŠ¼íŠ¼í•´. ì—¬ê¸°ì— êµ¬ë©ì„ ëš«ì–´ì„œ ì˜·ì„ ê¿°ë§¤ ì…ìœ¼ë©´ ì°¬ ë°”ëŒë„ ë„ë–¡ì—†ì§€!"</p>
                    <p><span class="char-yul">ìœ¨ì´:</span> "ìš°ì™€! ì €ê²Œ ì„¸ê³„ ìµœì´ˆì˜ ë°”ëŠ˜ì´êµ¬ë‚˜!"</p>
                `
            },
            {
                type: 'story',
                image: 'images/needle4.jpg',
                title: '3ì¥: ê³° ì‚¬ëƒ¥ê¾¼ì˜ íŠ¼íŠ¼í•œ ë°”ëŠ˜',
                sub: '(ìœ ëŸ½ì˜ ë†’ì€ ì‚°ì† ë™êµ´)',
                content: `
                    <p class="mb-2"><span class="char-yul">ìœ¨ì´:</span> "ì €ê¸° ìŒ“ì¸ ê±´ ê³µë£¡ ë¼ˆì•¼?"</p>
                    <p class="mb-2"><span class="char-needle">ë°”ëŠ˜ê°ì‹œ:</span> "ì €ê±´ ë¬´ì‹œë¬´ì‹œí•œ ë™êµ´ê³°(Cave bear) ë¼ˆì•¼!"</p>
                    <p class="mb-2"><span class="char-ancient">ì‚°ì´:</span> (ë¼ˆë¥¼ ê°ˆë©°) "ë‘êº¼ìš´ ê³° ê°€ì£½ì„ ëš«ìœ¼ë ¤ë©´ ìƒˆ ë¼ˆë¡œëŠ” ì•ˆ ë¼. ê·¸ë˜ì„œ ìš°ë¦° ë” ë‹¨ë‹¨í•œ ê³° ë¼ˆë‚˜ ì‚¬ìŠ´ ë¼ˆë¡œ ë°”ëŠ˜ì„ ë§Œë“¤ì§€!"</p>
                    <p><span class="char-yul">ìœ¨ì´:</span> "ì˜·ì´ ë‘êº¼ìš°ë©´ ë°”ëŠ˜ë„ íŠ¼íŠ¼í•´ì•¼ í•˜ëŠ”êµ¬ë‚˜!"</p>
                `
            },
            {
                type: 'story',
                image: 'images/needle5.jpg',
                title: '4ì¥: ì ˆëŒ€ ë¶€ëŸ¬ì§€ì§€ ì•ŠëŠ” ëŒ ë°”ëŠ˜',
                sub: '(ë°”ëŒ ë¶€ëŠ” í‹°ë² íŠ¸ ê³ ì›)',
                content: `
                    <p class="mb-2"><span class="char-yul">ìœ¨ì´:</span> "ë°”ëŠ˜ê°ì‹œì•¼, ë¼ˆë°”ëŠ˜ì€ ì“°ë‹¤ê°€ ëš ë¶€ëŸ¬ì§€ë©´ ì–´ë–¡í•´?"</p>
                    <p class="mb-2"><span class="char-ancient">ëŒì´:</span> (ë•€ì„ ë»˜ë»˜) "ì•„ì´ê³  íŒ”ì´ì•¼. ì´ ëŒì€ ê°ˆê¸°ê°€ 10ë°°ëŠ” í˜ë“¤ì§€ë§Œ, ë‹¤ ë§Œë“¤ë©´ ì ˆëŒ€ ë¶€ëŸ¬ì§€ì§€ ì•ŠëŠ” ëŒë°”ëŠ˜ì´ ë˜ì§€!"</p>
                    <p><span class="char-yul">ìœ¨ì´:</span> "ìš°ì™€... ëŒì„ ê°ˆì•„ì„œ ì €ë ‡ê²Œ ì–‡ê²Œ ë§Œë“¤ë‹¤ë‹ˆ, ì •ë§ ëŒ€ë‹¨í•œ ì •ì„±ì´ë‹¤!"</p>
                `
            },
            {
                type: 'story',
                image: 'images/needle6.jpg',
                title: '5ì¥: ìš°ë¦¬ë‚˜ë¼ì˜ ë³´ë¬¼ì°½ê³ ',
                sub: '(ë¶€ì‚° ë°”ë‹·ê°€ íŒ¨ì´(ì¡°ê°œë¬´ì§€) ì•)',
                content: `
                    <p class="mb-2"><span class="char-ancient">ë°”ë‹¤:</span> "ì•„ë¹ ê°€ ê³ ë˜ ì¡ìœ¼ëŸ¬ ê°€ì‹ ëŒ€! ë¹¨ë¦¬ ì´ ë¬¼ê°œ ë¼ˆ ë°”ëŠ˜ë¡œ ê·¸ë¬¼ì„ ê³ ì³ì•¼ í•´."</p>
                    <p class="mb-2"><span class="char-yul">ìœ¨ì´:</span> "ê·¸ëŸ°ë° ì™œ ì†Œì¤‘í•œ ë°”ëŠ˜ì´ ì“°ë ˆê¸°ì¥(íŒ¨ì´)ì—ì„œ ë°œê²¬ë¼?"</p>
                    <p class="mb-2"><span class="char-needle">ë°”ëŠ˜ê°ì‹œ:</span> "í™ ì†ì— ë¼ˆë¥¼ ê·¸ëƒ¥ ë‘ë©´ ë…¹ì•„ë²„ë¦¬ëŠ”ë°, ì¡°ê°œê»ë°ê¸°ê°€ ë°”ëŠ˜ì„ ê°ì‹¸ì„œ ë³´í˜¸í•´ ì¤€ ë•ë¶„ì— ì©ì§€ ì•Šì€ ê±°ì•¼."</p>
                    <p><span class="char-yul">ìœ¨ì´:</span> "ì¡°ê°œê»ë°ê¸°ê°€ íƒ€ì„ìº¡ìŠì´ì—ˆêµ¬ë‚˜!"</p>
                `
            },
            {
                type: 'story',
                image: 'images/needle7.jpg',
                title: '6ì¥: ìœ¨ì´ì˜ ê¹¨ë‹¬ìŒ',
                sub: '(ë‹¤ì‹œ ìœ¨ì´ì˜ ë°©)',
                content: `
                    <p class="mb-2"><span class="font-bold text-gray-500">ğŸ“¢</span> ëˆˆì„ ë²ˆì© ëœ¬ ìœ¨ì´!</p>
                    <p class="mb-2"><span class="char-yul">ìœ¨ì´:</span> "ê¿ˆì´ ì•„ë‹ˆì—ˆì–´! ë°”ëŠ˜ì€ ì˜›ë‚  ì‚¬ëŒë“¤ì˜ ì§€í˜œê°€ ë‹´ê¸´ ìµœê³ ì˜ ë°œëª…í’ˆì´ì—ˆì–´!"</p>
                    <p class="mb-2"><span class="font-bold text-gray-700">ì„ ë¯¸:</span> "ìœ¨ì´ì•¼ í•™êµ ê°€ì•¼ì§€! ì‹œë‚˜ëª¨ë¡¤ ì¸í˜•, íŒ¨ë”©ì— ë‹¤ì‹œ ê¿°ë§¤ ë†¨ë‹¨ë‹¤."</p>
                    <p><span class="char-yul">ìœ¨ì´:</span> "ë„¤! ì €ë„ ë‚˜ì¤‘ì— ë°”ëŠ˜ì²˜ëŸ¼ ê¼­ í•„ìš”í•œ ê±¸ ë°œëª…í• ë˜ìš”!"</p>
                `
            },
            {
                type: 'quiz_intro',
                image: 'images/needle8.jpg',
                title: 'ìœ¨ì´ì˜ ì•Œì­ë‹¬ì­ O, X í€´ì¦ˆ',
                content: `
                    <p class="mb-4 text-center text-lg">"ë°”ëŠ˜ê°ì‹œì™€ì˜ ì—¬í–‰ ì¦ê±°ì› ë‚˜ìš”?"</p>
                    <p class="text-center text-gray-600">ìœ¨ì´ì™€ í•¨ê»˜ ë°°ìš´ ë‚´ìš©ì„<br>í€´ì¦ˆë¡œ í’€ì–´ë´ìš”! (3ë¬¸ì œ)</p>
                `
            },
            {
                type: 'ending',
                image: 'images/needle9.jpg',
                alt: 'ë'
            }
        ];

        const quizData = [
            {
                question: "ì„¸ê³„ì—ì„œ ê°€ì¥ ì˜¤ë˜ëœ ë°”ëŠ˜ì€ 'í”Œë¼ìŠ¤í‹±'ìœ¼ë¡œ ë§Œë“¤ì—ˆë‹¤?",
                answer: false,
                explanation: "ê°€ì¥ ì˜¤ë˜ëœ ë°”ëŠ˜ì€ <span class='text-rose-500 font-bold'>'ìƒˆì˜ ë¼ˆ'</span>ë¡œ ë§Œë“¤ì—ˆì–´ìš”. ì†ì´ ë¹„ì–´ ìˆì–´ì„œ êµ¬ë©ì„ ëš«ê¸° ì‰¬ì› ê±°ë“ ìš”."
            },
            {
                question: "ì˜›ë‚  ì‚¬ëŒë“¤ì€ ë°”ëŠ˜ë¡œ ì˜·ì„ ëª¸ì— ë”± ë§ê²Œ ë§Œë“¤ì–´ ì¶”ìœ„ë¥¼ ì´ê²¨ëƒˆë‹¤?",
                answer: true,
                explanation: "í—ë í•œ ê°€ì£½ë§Œ ê±¸ì¹˜ëŠ” ê²ƒë³´ë‹¤, ë°”ëŠ˜ë¡œ ê¿°ë§¤ì„œ <span class='text-blue-500 font-bold'>ëª¸ì— ë”± ë§ëŠ” ì˜·</span>ì„ ì…ìœ¼ë©´ ì²´ì˜¨ì„ ì§€í‚¬ ìˆ˜ ìˆì–´ìš”."
            },
            {
                question: "ìš°ë¦¬ë‚˜ë¼ ë¼ˆë°”ëŠ˜ì€ 'ì¡°ê°œë¬´ì§€(íŒ¨ì´)' ë•ë¶„ì— ì©ì§€ ì•Šê³  ë°œê²¬ë˜ì—ˆë‹¤?",
                answer: true,
                explanation: "ìš°ë¦¬ë‚˜ë¼ í™ì€ ë¼ˆë¥¼ ë…¹ì—¬ë²„ë¦¬ëŠ”ë°, <span class='text-orange-500 font-bold'>ì¡°ê°œê»ë°ê¸° ì„±ë¶„</span>ì´ ë¼ˆë°”ëŠ˜ì´ ì©ì§€ ì•Šë„ë¡ ë³´í˜¸í•´ ì¤¬ë‹µë‹ˆë‹¤."
            }
        ];

        // ìƒíƒœ ê´€ë¦¬
        let currentState = {
            pageIndex: 0,
            quizIndex: 0,
            quizStatus: 'question',
            lastAnswer: null
        };

        const app = document.getElementById('app');

        function render() {
            app.innerHTML = ''; 
            
            if (currentState.pageIndex < storyData.length) {
                const page = storyData[currentState.pageIndex];
                
                if (page.type === 'cover') {
                    renderCover(page);
                } else if (page.type === 'ending') {
                    renderEnding(page);
                } else if (page.type === 'quiz_intro') {
                    renderStoryPage(page, true);
                } else {
                    renderStoryPage(page, false);
                }
            } 
            else if (currentState.pageIndex === storyData.length) {
                renderQuiz();
            }
        }

        // --- ì»´í¬ë„ŒíŠ¸ ---

        function renderCover(data) {
            const div = document.createElement('div');
            div.className = "w-full h-full relative cursor-pointer fade-in";
            div.onclick = nextPage;
            div.innerHTML = `
                <div class="img-container">
                    <img src="${data.image}" class="img-cover" alt="${data.alt}" onerror="this.parentElement.innerHTML='<div class=\\'w-full h-full bg-slate-200 flex flex-col items-center justify-center text-slate-600 font-comic\\'><span class=\\'text-6xl mb-4\\'>ğŸª¡ğŸ¦•</span><h1 class=\\'text-center text-2xl\\'>ìœ¨ì´ì˜ ì—­ì‚¬ì—¬í–‰<br>ë°”ëŠ˜ê°ì‹œì˜ ì¡°ìƒì„<br>ì°¾ì•„ì„œ</h1><p class=\\'text-sm mt-8 animate-pulse\\'>í™”ë©´ì„ í„°ì¹˜í•˜ì„¸ìš”</p></div>'">
                </div>
                <div class="absolute bottom-10 w-full text-center text-white font-comic animate-pulse text-xl drop-shadow-md bg-slate-900/40 py-2">
                    í™”ë©´ì„ íƒ­í•˜ì—¬ ì‹œê°„ì—¬í–‰ ë– ë‚˜ê¸°
                </div>
            `;
            app.appendChild(div);
        }

        function renderStoryPage(data, isQuizIntro) {
            const div = document.createElement('div');
            div.className = "w-full h-full flex flex-col bg-white fade-in";
            
            const imgHtml = `
                <div class="flex-1 img-container relative border-b-4 border-slate-300">
                    <img src="${data.image}" class="img-fit" alt="ì‚½í™”" onerror="this.parentElement.innerHTML='<div class=\\'w-full h-full bg-slate-50 flex items-center justify-center text-gray-400\\'>ì´ë¯¸ì§€ ì¤€ë¹„ì¤‘<br>${data.image}</div>'">
                </div>
            `;

            const textHtml = `
                <div class="h-[40%] flex flex-col relative bg-slate-100">
                    <div class="flex-1 p-6 overflow-y-auto text-box -mt-6 z-10 text-lg leading-relaxed text-slate-800">
                        ${data.title ? `<h2 class="font-comic text-2xl text-slate-600 mb-1 flex items-center gap-2"><span class="text-sm">ğŸ§µ</span>${data.title}</h2>` : ''}
                        ${data.sub ? `<p class="text-sm text-gray-500 mb-4">${data.sub}</p>` : ''}
                        <div class="space-y-2">
                            ${data.content}
                        </div>
                    </div>
                    
                    <div class="h-20 bg-white flex justify-between items-center px-8 border-t border-slate-200 z-20 shadow-[0_-4px_10px_rgba(0,0,0,0.05)]">
                        <div onclick="prevPage()" class="btn-prev-needle flex flex-col items-center cursor-pointer text-slate-400 hover:text-slate-600 transition">
                            <span class="text-3xl">ğŸª¡</span>

                        </div>
                        
                        ${isQuizIntro ? 
                            `<div onclick="startQuiz()" class="btn-quiz flex flex-col items-center cursor-pointer text-rose-500">
                                <div class="w-14 h-14 bg-rose-500 rounded-full flex items-center justify-center text-white text-3xl font-bold shadow-lg border-4 border-rose-200">?</div>
                                <span class="text-xs font-bold mt-1 text-rose-600">í€´ì¦ˆ ì‹œì‘!</span>
                            </div>` 
                            : 
                            `<div onclick="nextPage()" class="btn-next-needle flex flex-col items-center text-slate-500">
                                <span class="text-4xl">ğŸª¡</span>
				<span class="text-xs font-bold mt-1 text-orange-600">ë‹¤ìŒ</span>
                            </div>`
                        }
                    </div>
                </div>
            `;
            
            div.innerHTML = imgHtml + textHtml;
            app.appendChild(div);
        }

        function renderQuiz() {
            if (currentState.quizIndex >= quizData.length) {
                currentState.pageIndex = storyData.length - 1; 
                currentState.quizIndex = 0;
                render();
                return;
            }

            const currentQ = quizData[currentState.quizIndex];
            const div = document.createElement('div');
            div.className = "w-full h-full flex flex-col bg-slate-50 fade-in";

            let contentHtml = '';

            if (currentState.quizStatus === 'question') {
                contentHtml = `
                    <div class="flex-1 flex flex-col items-center justify-center p-6 text-center">
                        <span class="text-slate-500 font-bold text-xl mb-4 bg-slate-200 px-4 py-1 rounded-full">ë¬¸ì œ ${currentState.quizIndex + 1} / 3</span>
                        <div class="bg-white p-8 rounded-2xl shadow-xl w-full mb-8 border-2 border-slate-300">
                            <p class="text-2xl font-bold leading-normal break-keep text-slate-800">${currentQ.question}</p>
                        </div>
                        <div class="flex gap-6 w-full justify-center">
                            <button onclick="checkAnswer(true)" class="w-24 h-24 bg-blue-500 rounded-full text-white text-5xl font-black shadow-lg hover:bg-blue-600 active:scale-95 transition border-4 border-blue-300 ring-2 ring-offset-2 ring-blue-200">O</button>
                            <button onclick="checkAnswer(false)" class="w-24 h-24 bg-red-500 rounded-full text-white text-5xl font-black shadow-lg hover:bg-red-600 active:scale-95 transition border-4 border-red-300 ring-2 ring-offset-2 ring-red-200">X</button>
                        </div>
                    </div>
                    <div class="h-20 bg-white border-t border-slate-200 flex items-center px-4">
                        <button onclick="exitQuiz()" class="text-slate-400 font-bold text-sm">â—€ ëŒì•„ê°€ê¸°</button>
                    </div>
                `;
            } 
            else if (currentState.quizStatus === 'result') {
                const isCorrect = currentState.lastAnswer === currentQ.answer;
                const emoji = isCorrect ? 'ğŸŠğŸª¡ğŸŠ' : 'ğŸ§±ğŸ”¨ğŸ§±'; 
                const bgColor = isCorrect ? 'bg-sky-500' : 'bg-rose-500';
                const message = isCorrect ? 'ì •ë‹µì…ë‹ˆë‹¤!' : 'ë•¡! í‹€ë ¸ì–´ìš”!';

                contentHtml = `
                    <div class="w-full h-full ${bgColor} flex flex-col items-center justify-center text-white cursor-pointer" onclick="showExplanation()">
                        <div class="text-8xl mb-6 animate-bounce">${emoji}</div>
                        <h2 class="text-4xl font-comic mb-4 drop-shadow-md">${message}</h2>
                        <p class="animate-pulse text-lg opacity-90">í™”ë©´ì„ íƒ­í•˜ì—¬ í•´ì„¤ ë³´ê¸°</p>
                    </div>
                `;
            }
            else if (currentState.quizStatus === 'explanation') {
                const isLastQuestion = currentState.quizIndex === quizData.length - 1;
                const nextButtonText = isLastQuestion ? "ì—¬í–‰ ë§ˆì¹˜ê¸°" : "ë‹¤ìŒ ë¬¸ì œ";

                contentHtml = `
                    <div class="flex-1 flex flex-col p-6 bg-white cursor-pointer" onclick="nextQuizStep()">
                        <div class="flex-1 flex flex-col justify-center items-center">
                            <h3 class="text-2xl font-comic text-slate-600 mb-6 flex items-center gap-2"><span>ğŸ‘§ğŸ»</span> ìœ¨ì´ì˜ í•´ì„¤</h3>
                            <div class="bg-slate-50 p-6 rounded-xl border-2 border-slate-300 shadow-md w-full relative">
                                <div class="absolute -top-4 -left-2 text-4xl">ğŸ’¡</div>
                                <p class="text-xl font-medium text-slate-800 leading-relaxed mt-2 word-keep">
                                    "${currentQ.explanation}"
                                </p>
                            </div>
                        </div>
                        <div class="h-24 w-full flex items-center justify-center">
                            <div class="btn-next-needle flex flex-col items-center">
                                <span class="text-4xl text-slate-600">ğŸª¡</span>
                                <span class="text-sm font-bold text-slate-500 mt-1">${nextButtonText}</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            div.innerHTML = contentHtml;
            app.appendChild(div);
        }

        function renderEnding(data) {
            const div = document.createElement('div');
            div.className = "w-full h-full relative cursor-pointer fade-in";
            div.onclick = restart;
            div.innerHTML = `
                <div class="img-container">
                    <img src="${data.image}" class="img-cover" alt="ë" onerror="this.parentElement.innerHTML='<div class=\\'w-full h-full bg-slate-200 flex flex-col items-center justify-center text-slate-500\\'><span class=\\'text-6xl mb-4\\'>ğŸ«</span><p>ì—­ì‚¬ ì—¬í–‰ ë!</p></div>'">
                </div>
                <div class="absolute bottom-10 w-full text-center text-white font-comic animate-pulse text-xl bg-black/50 py-2">
                    ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸° â†º
                </div>
            `;
            app.appendChild(div);
        }

        // --- ë¡œì§ ---

        function nextPage() {
            if (currentState.pageIndex < storyData.length) {
                currentState.pageIndex++;
                render();
            }
        }

        function prevPage() {
            if (currentState.pageIndex > 0) {
                currentState.pageIndex--;
                render();
            }
        }

        function startQuiz() {
            currentState.pageIndex = storyData.length; 
            currentState.quizIndex = 0;
            currentState.quizStatus = 'question';
            render();
        }

        function exitQuiz() {
            currentState.pageIndex--; 
            render();
        }

        function checkAnswer(userAnswer) {
            currentState.lastAnswer = userAnswer;
            currentState.quizStatus = 'result';
            render();
        }

        function showExplanation() {
            currentState.quizStatus = 'explanation';
            render();
        }

        function nextQuizStep() {
            currentState.quizIndex++;
            currentState.quizStatus = 'question';
            render();
        }

        function restart() {
            currentState.pageIndex = 0;
            currentState.quizIndex = 0;
            render();
        }

        render();

    </script>
</body>
</html>
