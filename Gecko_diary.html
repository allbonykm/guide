<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¦ë°±í•© ìœ¡ì•„ì¼ê¸°</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° ì´ˆê¸°í™” */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body, html { width: 100%; height: 100%; font-family: 'Jua', sans-serif; overflow: hidden; }
        
        /* ê³µí†µ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .page {
            width: 100%;
            height: 100vh;
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: absolute;
            top: 0; left: 0;
            text-align: center;
        }
        
        .active { display: flex; } /* í™œì„± í˜ì´ì§€ í‘œì‹œ */
        
        /* í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        h1, h2, p {
            color: #F5F5DC; /* ë² ì´ì§€ìƒ‰ */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5); /* ê°€ë…ì„±ì„ ìœ„í•œ ê·¸ë¦¼ì */
        }
        h1 { font-size: 3rem; margin-bottom: 20px; }
        h2 { font-size: 2.5rem; margin-top: 30px; margin-bottom: 30px; }
        
        /* í˜ì´ì§€ë³„ ë°°ê²½ ì„¤ì • */
        #page1 { background-image: url('images/gecko1.JPG'); cursor: pointer; }
        #page2 { background-image: url('images/gecko2.png'); justify-content: flex-start; }
        #page3 { background-image: url('images/gecko3.jpg'); }
        #page4 { background-image: url('images/gecko4.jpg'); justify-content: flex-end; }

        /* Page 2: ì¡°ì•½ëŒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .pebble-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 80%;
            margin-bottom: 20px;
        }

        .pebble {
            padding: 20px;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; /* ì¡°ì•½ëŒ ëª¨ì–‘ */
            border: none;
            font-family: 'Jua', sans-serif;
            font-size: 1.5rem;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.1s, opacity 0.3s;
            opacity: 0.6; /* ì„ íƒ ì „ íë¦¼ */
            box-shadow: 3px 3px 10px rgba(0,0,0,0.2);
        }
        
        .pebble.selected {
            opacity: 1;
            transform: scale(1.05);
            border: 3px solid #fff;
        }

        /* ë¬´ì§€ê°œ ìƒ‰ìƒ (íŒŒìŠ¤í…” í†¤) */
        .pebble:nth-child(1) { background-color: #FF6B6B; } /* ë¹¨ê°• */
        .pebble:nth-child(2) { background-color: #FFD93D; color: #555; } /* ë…¸ë‘ */
        .pebble:nth-child(3) { background-color: #6BCB77; } /* ì´ˆë¡ */
        .pebble:nth-child(4) { background-color: #4D96FF; } /* íŒŒë‘ */

        .next-btn, .confirm-btn {
            margin-top: 20px;
            padding: 10px 30px;
            font-size: 1.2rem;
            border-radius: 20px;
            border: none;
            background-color: rgba(255, 255, 255, 0.8);
            font-family: 'Jua', sans-serif;
            cursor: pointer;
        }

        /* Page 3: ëª¸ë¬´ê²Œ ì…ë ¥ */
        .input-group {
            background: rgba(0,0,0,0.4);
            padding: 30px;
            border-radius: 20px;
        }
        input[type="number"] {
            font-size: 2rem;
            padding: 10px;
            width: 150px;
            text-align: center;
            border-radius: 10px;
            border: none;
            outline: none;
            background: rgba(255,255,255,0.9);
            font-family: 'Jua', sans-serif;
        }
        input::placeholder { color: #ccc; }
        .unit { color: #F5F5DC; font-size: 2rem; margin-left: 10px; }

        /* Page 4: í•˜ë‹¨ ë©”ì‹œì§€ ë°•ìŠ¤ */
        .outro-box {
            background-color: rgba(255, 248, 220, 0.9); /* ì˜…ì€ ë² ì´ì§€ */
            width: 90%;
            padding: 30px;
            margin-bottom: 50px;
            border-radius: 20px;
            color: #5D4037;
            font-size: 1.8rem;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }

        /* ë¡œë”© í‘œì‹œ */
        #loading {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center; align-items: center; color: white; font-size: 2rem;
            z-index: 999;
        }
    </style>
</head>
<body>

    <div id="loading">ê¸°ë¡ ì¤‘...</div>

    <div id="page1" class="page active" onclick="goToPage(2)">
        <h1>ë°±í•©ì´ í‚¤ìš°ê¸°!</h1>
        <p>(íƒ­í•˜ì—¬ ì‹œì‘)</p>
    </div>

    <div id="page2" class="page">
        <h2>ì˜¤ëŠ˜ ë­ í–ˆì–´?</h2>
        <div class="pebble-container">
            <button class="pebble" data-action="feeding" onclick="toggleSelection(this)">ë¨¹ì´ì£¼ê¸°</button>
            <button class="pebble" data-action="handling" onclick="toggleSelection(this)">í•¸ë“¤ë§</button>
            <button class="pebble" data-action="cleaning" onclick="toggleSelection(this)">ì§‘ ì¹˜ì›Œì£¼ê¸°</button>
            <button class="pebble" data-action="weight" onclick="toggleSelection(this)">ëª¸ë¬´ê²Œ ì¸¡ì •</button>
        </div>
        <button class="next-btn" onclick="finishSelection()">ë‹¤ìŒ</button>
    </div>

    <div id="page3" class="page">
        <h2>ëª¸ë¬´ê²Œ ì…ë ¥</h2>
        <div class="input-group">
            <input type="number" id="weightInput" step="0.1" placeholder="...">
            <span class="unit">g</span>
        </div>
        <button class="confirm-btn" onclick="submitWeight()">í™•ì¸</button>
    </div>

    <div id="page4" class="page">
        <div class="outro-box" onclick="resetApp()">
            ë°±í•©ì•„! ë‚´ì¼ ë³´ì!
        </div>
    </div>

    <script>
        // *** ì¤‘ìš”: ì—¬ê¸°ì— 1ë‹¨ê³„ì—ì„œ ë³µì‚¬í•œ Google Apps Script ë°°í¬ URLì„ ë„£ìœ¼ì„¸ìš” ***
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxhMcFL8XtIYs72iI99WHL5KN69O0K7q2Mw2aeqVLpTvJhssHvMJ5-9SoJhWbSOhHI/exec"; 
        
        // ìƒíƒœ ë³€ìˆ˜
        let selectedActions = {
            feeding: false,
            handling: false,
            cleaning: false,
            weight: false
        };
        let currentWeight = "";

        // í˜ì´ì§€ ì´ë™ í•¨ìˆ˜
        function goToPage(pageNum) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page' + pageNum).classList.add('active');

            // 3í˜ì´ì§€ ì§„ì… ì‹œ ìµœê·¼ ëª¸ë¬´ê²Œ ë¶ˆëŸ¬ì˜¤ê¸° (ì„ íƒ ì‚¬í•­)
            if(pageNum === 3 && SCRIPT_URL !== "ì—¬ê¸°ì—_ì›¹ì•±_URLì„_ë¶™ì—¬ë„£ìœ¼ì„¸ìš”") {
                fetchLastWeight();
            }
        }

        // 2í˜ì´ì§€: ë²„íŠ¼ ì„ íƒ í† ê¸€
        function toggleSelection(element) {
            element.classList.toggle('selected');
            const action = element.getAttribute('data-action');
            selectedActions[action] = element.classList.contains('selected');
        }

        // 2í˜ì´ì§€: ë‹¤ìŒ ë²„íŠ¼ ë¡œì§
        function finishSelection() {
            if (selectedActions.weight) {
                goToPage(3);
            } else {
                // ëª¸ë¬´ê²Œ ì¸¡ì • ì•ˆ í•¨ -> ë°”ë¡œ ë°ì´í„° ì „ì†¡ í›„ 4í˜ì´ì§€ë¡œ
                sendData();
            }
        }

        // 3í˜ì´ì§€: ëª¸ë¬´ê²Œ í™•ì¸ ë²„íŠ¼
        function submitWeight() {
            const inputVal = document.getElementById('weightInput').value;
            if (!inputVal) {
                alert("ëª¸ë¬´ê²Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }
            currentWeight = inputVal;
            sendData();
        }
        
        // ë°ì´í„° ì „ì†¡ (Google Sheetsë¡œ)
        function sendData() {
            document.getElementById('loading').style.display = 'flex';
            
            // ë°ì´í„° ì¤€ë¹„
            const formData = new FormData();
            formData.append('feeding', selectedActions.feeding);
            formData.append('handling', selectedActions.handling);
            formData.append('cleaning', selectedActions.cleaning);
            formData.append('weight', selectedActions.weight ? currentWeight : "");

            fetch(SCRIPT_URL, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('loading').style.display = 'none';
                goToPage(4);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('loading').style.display = 'none';
                alert("ì €ì¥ ì‹¤íŒ¨ ã… ã…  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                goToPage(4); // ì—ëŸ¬ë‚˜ë„ ì¼ë‹¨ ë„˜ê¹€ (UXìƒ)
            });
        }

        // ìµœê·¼ ëª¸ë¬´ê²Œ ë¶ˆëŸ¬ì˜¤ê¸° (Placeholderìš©)
        function fetchLastWeight() {
            fetch(SCRIPT_URL)
            .then(res => res.json())
            .then(data => {
                if(data.lastWeight) {
                    document.getElementById('weightInput').placeholder = data.lastWeight;
                }
            });
        }

        // ì•± ë¦¬ì…‹ (ì²˜ìŒìœ¼ë¡œ)
        function resetApp() {
            // ì„ íƒ ì´ˆê¸°í™”
            selectedActions = { feeding: false, handling: false, cleaning: false, weight: false };
            currentWeight = "";
            document.getElementById('weightInput').value = "";
            document.querySelectorAll('.pebble').forEach(el => el.classList.remove('selected'));
            goToPage(1);
        }
    </script>
</body>
</html>
