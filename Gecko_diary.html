<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ¦ë°±í•© ìœ¡ì•„ì¼ê¸°</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° ì´ˆê¸°í™” */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body, html { width: 100%; height: 100%; font-family: 'Jua', sans-serif; overflow: hidden; }
        
        /* ê³µí†µ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .page {
            width: 100%;
            height: 100vh;
            display: none; 
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: absolute;
            top: 0; left: 0;
            text-align: center;
        }
        
        .active { display: flex; } 
        
        /* í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        h1, h2, p { text-shadow: 2px 2px 4px rgba(0,0,0,0.6); }
        h1 { font-size: 4.5rem; margin-bottom: 20px; color: #FFFDD0; }
        h2 { font-size: 2.5rem; margin-top: 30px; margin-bottom: 30px; color: #F5F5DC; }
        p { color: #F5F5DC; }
        
        /* ë°°ê²½ ì´ë¯¸ì§€ ê²½ë¡œ */
        #page1 { background-image: url('images/gecko1.jpg'); cursor: pointer; }
        #page2 { background-image: url('images/gecko2.jpg'); justify-content: flex-start; }
        #page3 { background-image: url('images/gecko3.jpg'); }
        #page4 { background-image: url('images/gecko4.jpg'); justify-content: flex-end; }

        /* ì¡°ì•½ëŒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .pebble-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
            margin-bottom: 20px;
        }

        .pebble {
            width: 60%;
            max-width: 250px;
            padding: 15px;
            border-radius: 50px; 
            border: none;
            font-family: 'Jua', sans-serif;
            font-size: 1.4rem;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.1s, opacity 0.3s;
            opacity: 0.7;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.2);
        }
        
        .pebble.selected {
            opacity: 1;
            transform: scale(1.05);
            border: 3px solid #fff;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
        }

        .pebble:nth-child(1) { background-color: #FF8787; } 
        .pebble:nth-child(2) { background-color: #FFD43B; color: #555; } 
        .pebble:nth-child(3) { background-color: #69DB7C; } 
        .pebble:nth-child(4) { background-color: #4DABF7; }

        .next-btn, .confirm-btn {
            margin-top: 20px;
            padding: 10px 30px;
            font-size: 1.2rem;
            border-radius: 20px;
            border: none;
            background-color: rgba(255, 255, 255, 0.9);
            font-family: 'Jua', sans-serif;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* ì…ë ¥ì°½ ë° ë©”ì‹œì§€ ë°•ìŠ¤ */
        .input-group { background: rgba(0,0,0,0.5); padding: 30px; border-radius: 20px; }
        input[type="number"] {
            font-size: 2rem; padding: 10px; width: 150px; text-align: center;
            border-radius: 10px; border: none; outline: none; background: rgba(255,255,255,0.9);
            font-family: 'Jua', sans-serif;
        }
        .unit { color: #F5F5DC; font-size: 2rem; margin-left: 10px; }

        .outro-box {
            background-color: rgba(255, 253, 208, 0.95);
            width: 85%; padding: 30px; margin-bottom: 60px;
            border-radius: 30px; color: #5D4037; font-size: 2rem;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.3);
            cursor: pointer;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }

        #loading {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.5); display: none;
            justify-content: center; align-items: center; color: white; font-size: 2rem;
            z-index: 999;
        }
    </style>
</head>
<body>

    <div id="loading">ê¸°ë¡ ì¤‘...</div>

    <div id="page1" class="page active" onclick="goToPage(2)">
        <h1>ë°±í•©ì´ í‚¤ìš°ê¸°!</h1>
        <p>(íƒ­í•˜ì—¬ ì‹œì‘)</p>
    </div>

    <div id="page2" class="page">
        <h2>ì˜¤ëŠ˜ ë­ í–ˆì–´?</h2>
        <div class="pebble-container">
            <button class="pebble" data-action="feeding" onclick="toggleSelection(this)">ë¨¹ì´ì£¼ê¸°</button>
            <button class="pebble" data-action="handling" onclick="toggleSelection(this)">í•¸ë“¤ë§</button>
            <button class="pebble" data-action="cleaning" onclick="toggleSelection(this)">ì§‘ ì¹˜ì›Œì£¼ê¸°</button>
            <button class="pebble" data-action="weight" onclick="toggleSelection(this)">ëª¸ë¬´ê²Œ ì¸¡ì •</button>
        </div>
        <button class="next-btn" onclick="finishSelection()">ë‹¤ìŒ</button>
    </div>

    <div id="page3" class="page">
        <h2>ëª¸ë¬´ê²Œ ì…ë ¥</h2>
        <div class="input-group">
            <input type="number" id="weightInput" step="0.1" placeholder="...">
            <span class="unit">g</span>
        </div>
        <button class="confirm-btn" onclick="submitWeight()">í™•ì¸</button>
    </div>

    <div id="page4" class="page">
        <div class="outro-box" onclick="resetApp()">
            ë°±í•©ì•„! ë‚´ì¼ ë³´ì! ğŸ””
        </div>
    </div>

    <script>
        // *** Google Apps Script ë°°í¬ URL ***
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxhMcFL8XtIYs72iI99WHL5KN69O0K7q2Mw2aeqVLpTvJhssHvMJ5-9SoJhWbSOhHI/exec"; 
        
        // [ì¶”ê°€] ìŠ¹ë¦¬/ì„±ê³µ ìºëŸ´ ì¢…ì†Œë¦¬ ì„¤ì •
        const victorySound = new Audio('https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3');

        let selectedActions = { feeding: false, handling: false, cleaning: false, weight: false };
        let currentWeight = "";

        function goToPage(pageNum) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page' + pageNum).classList.add('active');

            if(pageNum === 3 && SCRIPT_URL.startsWith("http")) {
                fetchLastWeight();
            }
        }

        function toggleSelection(element) {
            element.classList.toggle('selected');
            const action = element.getAttribute('data-action');
            selectedActions[action] = element.classList.contains('selected');
        }

        function finishSelection() {
            if (selectedActions.weight) {
                goToPage(3);
            } else {
                sendData();
            }
        }

        function submitWeight() {
            const inputVal = document.getElementById('weightInput').value;
            if (!inputVal) {
                alert("ëª¸ë¬´ê²Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }
            currentWeight = inputVal;
            sendData();
        }
        
        function sendData() {
            document.getElementById('loading').style.display = 'flex';
            
            const formData = new FormData();
            formData.append('feeding', selectedActions.feeding);
            formData.append('handling', selectedActions.handling);
            formData.append('cleaning', selectedActions.cleaning);
            formData.append('weight', selectedActions.weight ? currentWeight : "");

            fetch(SCRIPT_URL, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('loading').style.display = 'none';
                
                // [ì¶”ê°€] ë°ì´í„° ì €ì¥ ì„±ê³µ ì‹œ ì¢…ì†Œë¦¬ ì¬ìƒ!
                victorySound.play();
                
                goToPage(4);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('loading').style.display = 'none';
                alert("ì €ì¥ ì‹¤íŒ¨ ã… ã…  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                goToPage(4);
            });
        }

        function fetchLastWeight() {
            fetch(SCRIPT_URL)
            .then(res => res.json())
            .then(data => {
                if(data.lastWeight) {
                    document.getElementById('weightInput').placeholder = data.lastWeight;
                }
            })
            .catch(e => console.log("ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨(ë¬´ì‹œê°€ëŠ¥)"));
        }

        // ì•± ë¦¬ì…‹ í•¨ìˆ˜
        function resetApp() {
            // [ì¶”ê°€] ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°ˆ ë•Œ ì†Œë¦¬ ë„ê¸°
            victorySound.pause();
            victorySound.currentTime = 0; 

            selectedActions = { feeding: false, handling: false, cleaning: false, weight: false };
            currentWeight = "";
            document.getElementById('weightInput').value = "";
            document.querySelectorAll('.pebble').forEach(el => el.classList.remove('selected'));
            goToPage(1);
        }
    </script>
</body>
</html>
