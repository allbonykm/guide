<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë°”ëŒì˜ ìš”ì • ì¡°ìœ¨!</title>
    <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap" rel="stylesheet">
    <style>
        /* --- ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ --- */
        :root {
            --cinnamoroll-blue: #9ED6E8;
            --cinnamoroll-dark-blue: #7ABCCE;
            --accent-pink: #FFB7C5;
            --text-dark: #557A8A;
        }

        body {
            font-family: 'Gamja Flower', cursive;
            background: linear-gradient(135deg, #e0f7fa 0%, #ffeef8 100%);
            margin: 0;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            color: var(--text-dark);
        }

        .screen {
            display: none;
            width: 90%;
            max-width: 380px;
            background: rgba(255, 255, 255, 0.95);
            padding: 35px 25px;
            border-radius: 30px;
            box-shadow: 0 15px 35px rgba(117, 185, 209, 0.3);
            border: 4px solid var(--cinnamoroll-blue);
            text-align: center;
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
        }

        .screen.active { display: block; }

        h2 {
            color: var(--cinnamoroll-dark-blue);
            font-size: 28px;
            margin-bottom: 25px;
            text-shadow: 1px 1px 0px #fff;
        }
        
        p { font-size: 22px; line-height: 1.4; }

        button {
            background-color: var(--cinnamoroll-blue);
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 24px;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            margin-top: 25px;
            font-family: 'Gamja Flower', cursive;
            box-shadow: 0 6px 0 #7ABCCE;
            transition: all 0.1s;
        }
        
        button:active {
            box-shadow: 0 2px 0 #7ABCCE;
            transform: translateY(4px);
        }
        
        /* ë²„íŠ¼ ë¹„í™œì„±í™” ìŠ¤íƒ€ì¼ (ì „ì†¡ ì¤‘ì¼ ë•Œ) */
        button:disabled {
            background-color: #ccc;
            box-shadow: none;
            cursor: not-allowed;
        }

        select, input {
            width: 100%;
            padding: 15px;
            font-size: 22px;
            border: 3px solid var(--accent-pink);
            border-radius: 20px;
            box-sizing: border-box;
            text-align: center;
            font-family: 'Gamja Flower', cursive;
            background-color: #FFF0F5;
            color: var(--text-dark);
            outline: none;
        }
        
        select:focus, input:focus { border-color: var(--cinnamoroll-blue); }
        input::placeholder { color: #aaa; font-size: 18px; }

        #screen4 {
            /* GitHubìš© ìƒëŒ€ ê²½ë¡œ ìœ ì§€ */
            background-image: url('images/cybike.jpg');
            background-size: cover;
            background-position: center;
            border-color: #FF69B4;
            padding: 300px 120px;
        }

        #screen4::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255, 182, 193, 0.5);
            z-index: 1;
        }

        #finalMessage {
            position: relative;
            z-index: 2;
            font-size: 36px;
            color: white;
            font-weight: bold;
            line-height: 1.6;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.6);
        }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>

    <div id="screen1" class="screen active">
        <h2 id="dateDisplay"></h2>
        <p>ì¡°ìœ¨ì•„ ì•ˆë…•! ğŸ‘‹<br>ì˜¤ëŠ˜ ìì „ê±° ì¬ë°Œê²Œ íƒ”ì–´?</p>
        <button onclick="nextScreen(2)">ì‘! ì™„ì „ ì¬ë°Œì—ˆì–´! ğŸš´â€â™€ï¸</button>
    </div>

    <div id="screen2" class="screen">
        <h2>ì˜¤ëŠ˜ ì–¼ë§ˆë‚˜ ë§ì´ íƒ”ì–´?</h2>
        <select id="distanceSelect"></select>
        <button onclick="nextScreen(3)">ì´ë§Œí¼ ë‹¬ë ¸ì§€! âœ…</button>
    </div>

    <div id="screen3" class="screen">
        <h2>ì–¼ë§ˆë‚˜ ìŒ©ìŒ© ë‹¬ë ¸ì–´?</h2>
        <p style="font-size:18px; color: var(--text-dark);">ê°€ì¥ ë¹¨ëë˜ ì†ë„ë¥¼ ì•Œë ¤ì¤˜!<br>(ë‹¨ìœ„: km/h)</p>
        <input type="number" id="speedInput" step="0.1" inputmode="decimal" placeholder="ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...">
        <p id="recordMsg" style="color: var(--accent-pink); font-size: 18px; margin-top: 15px; font-weight:bold;"></p>
        <button id="finishBtn" onclick="processSpeedAndFinish()">ì…ë ¥ ì™„ë£Œ! ğŸš€</button>
    </div>

    <div id="screen4" class="screen">
        <div id="finalMessage">
            ì™€ì•„! ëŒ€ë‹¨í•´!<br>
            ì˜¤ëŠ˜ë„ ë©‹ì§„ ì§ˆì£¼ì˜€ì–´!<br>
            ë°”ëŒì˜ ìš”ì • ì¡°ìœ¨!<br>
            ğŸ’¨ğŸ’–âœ¨
        </div>
    </div>

    <script>
        // ==========================================
        // [ì¤‘ìš”] ì—¬ê¸°ì— ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ë°°í¬ URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!
        // ì˜ˆ: https://script.google.com/macros/s/AKfycbx.../exec
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyXxBem17IS9mRWMjGWyDjz4cQ5NcHnFXNjOturbzmacU1dhhqxOb9h-n_9_hUqq5i4/exec'; 
        // ==========================================

        const today = new Date();
        const dateStr = `${today.getFullYear()}ë…„ ${today.getMonth() + 1}ì›” ${today.getDate()}ì¼`;
        document.getElementById('dateDisplay').innerText = dateStr;

        const select = document.getElementById('distanceSelect');
        for (let i = 100; i <= 5000; i += 100) {
            let option = document.createElement('option');
            let text = i < 1000 ? `${i}m` : `${(i/1000).toFixed(1)}km`;
            option.value = text;
            option.text = text;
            select.appendChild(option);
        }

        const STORAGE_KEY = 'joyul_max_speed_v2';

        function nextScreen(screenNum) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(`screen${screenNum}`).classList.add('active');
            if (screenNum === 3) {
                loadMaxSpeed();
            }
        }

        function loadMaxSpeed() {
            const savedSpeed = localStorage.getItem(STORAGE_KEY);
            const inputField = document.getElementById('speedInput');
            const msgField = document.getElementById('recordMsg');

            if (savedSpeed) {
                inputField.placeholder = `ì§€ë‚œë²ˆ ìµœê³  ê¸°ë¡: ${savedSpeed}`;
                msgField.innerText = `ğŸ† í˜„ì¬ ìµœê³  ê¸°ë¡: ${savedSpeed} km/h`;
            } else {
                inputField.placeholder = "ì—¬ê¸°ì— ìˆ«ìë¥¼ ì ì–´ì¤˜!";
                msgField.innerText = "ì•„ì§ ìµœê³  ê¸°ë¡ì´ ì—†ì–´. ì²« ê¸°ë¡ì— ë„ì „!";
            }
        }

        function processSpeedAndFinish() {
            const inputField = document.getElementById('speedInput');
            const distanceValue = document.getElementById('distanceSelect').value;
            const btn = document.getElementById('finishBtn');
            
            let currentSpeed = parseFloat(inputField.value);
            let savedSpeed = parseFloat(localStorage.getItem(STORAGE_KEY)) || 0;

            if (isNaN(currentSpeed)) {
                alert("ì†ë„ë¥¼ ìˆ«ìë¡œ ì…ë ¥í•´ì¤˜!");
                return;
            }

            // 1. ìµœê³  ì†ë„ ë¡œì§ (LocalStorage ì—…ë°ì´íŠ¸)
            if (currentSpeed > savedSpeed) {
                localStorage.setItem(STORAGE_KEY, currentSpeed.toFixed(1));
                alert(`ğŸŠ êº„ì•…! ì¶•í•˜í•´ ì¡°ìœ¨ì•„! ğŸŠ\nì‹ ê¸°ë¡ ë‹¬ì„±ì´ì•¼!\n\nì´ì „ ê¸°ë¡: ${savedSpeed}km/h\nğŸ‘‰ ìƒˆ ê¸°ë¡: ${currentSpeed}km/h`);
            }

            // 2. êµ¬ê¸€ ì‹œíŠ¸ë¡œ ë°ì´í„° ì „ì†¡ (ë¹„ë™ê¸° ì²˜ë¦¬)
            // ë²„íŠ¼ ë¹„í™œì„±í™” (ì—¬ëŸ¬ ë²ˆ ëˆ„ë¦„ ë°©ì§€)
            btn.disabled = true;
            btn.innerText = "ê¸°ë¡ ì €ì¥ ì¤‘...â³";

            // ì „ì†¡í•  ë°ì´í„° ì¤€ë¹„
            let formData = new FormData();
            formData.append('distance', distanceValue);
            formData.append('speed', currentSpeed);

            // fetchë¡œ êµ¬ê¸€ ìŠ¤í¬ë¦½íŠ¸ì— ì „ì†¡
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: formData,
                mode: 'no-cors' // ì¤‘ìš”: CORS ì—ëŸ¬ ë°©ì§€
            })
            .then(() => {
                // ì„±ê³µí•˜ë©´ ë§ˆì§€ë§‰ í™”ë©´ìœ¼ë¡œ ì´ë™
                nextScreen(4);
            })
            .catch(error => {
                console.error('Error:', error);
                alert("ê¸°ë¡ ì €ì¥ì— ì‹¤íŒ¨í–ˆì–´ ã… ã…  ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì¤˜.");
                btn.disabled = false;
                btn.innerText = "ì…ë ¥ ì™„ë£Œ! ğŸš€";
            });
        }
    </script>
</body>
</html>
