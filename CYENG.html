<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pete's English Class</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Fredoka', sans-serif; -webkit-tap-highlight-color: transparent; }
        .korean-font { font-family: 'Jua', sans-serif; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .animate-pop { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pop { 0% { transform: scale(0.9); } 100% { transform: scale(1); } }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-sky-50 text-slate-800 min-h-screen">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        /* ==================================================================================
           ‚ñº‚ñº‚ñº [Ïó¨Í∏∞ÏÑúÎ∂ÄÌÑ∞ Îç∞Ïù¥ÌÑ∞Î•º Î∞îÍøîÏ£ºÏÑ∏Ïöî] - ÏÉàÎ°úÏö¥ Ï±ÖÏùÑ ÎÑ£ÏùÑ Îïå Ïù¥ ÏïÑÎûò ÎÇ¥Ïö©ÏùÑ ÍµêÏ≤¥ÌïòÏÑ∏Ïöî ‚ñº‚ñº‚ñº
           ================================================================================== */

        // 1. Ïù¥ÏïºÍ∏∞ Îç∞Ïù¥ÌÑ∞ (Ìïú Î¨∏Ïû•Ïî©)
        const STORY_DATA = [
            { en: "Pete is going to the pet store.", ko: "ÌîºÌä∏Í∞Ä Ïï†ÏôÑÎèôÎ¨º Í∞ÄÍ≤åÏóê Í∞ÄÍ≥† ÏûàÏñ¥Ïöî." },
            { en: "He is going to get a pet.", ko: "Í∑∏Îäî Ïï†ÏôÑÎèôÎ¨ºÏùÑ ÏÇ¨Î†§Í≥† Ìï¥Ïöî." },
            { en: "Pete wants a bird, a hamster, or a lizard.", ko: "ÌîºÌä∏Îäî ÏÉàÎÇò ÌñÑÏä§ÌÑ∞, ÏïÑÎãàÎ©¥ ÎèÑÎßàÎ±ÄÏùÑ ÏõêÌï¥Ïöî." },
            { en: "But then Pete sees a goldfish.", ko: "ÌïòÏßÄÎßå Í∑∏Îïå ÌîºÌä∏Îäî Í∏àÎ∂ïÏñ¥Î•º Î≥¥ÏïòÏñ¥Ïöî." },
            { en: "\"That's what I want,\" he tells his mom.", ko: "\"Ï†ÄÍ≤å Ï†úÍ∞Ä ÏõêÌïòÎäî Í±∞ÏòàÏöî,\" Í∑∏Í∞Ä ÏóÑÎßàÏóêÍ≤å ÎßêÌï¥Ïöî." },
            { en: "Pete's mom gets fish food.", ko: "ÌîºÌä∏Ïùò ÏóÑÎßàÎäî Î¨ºÍ≥†Í∏∞ Î®πÏù¥Î•º ÏÇ¨Ïöî." },
            { en: "\"I'm going to call you Goldie,‚Äù Pete says to his new pet.", ko: "\"ÎÑê Í≥®ÎîîÎùºÍ≥† Î∂ÄÎ•º Í±∞Ïïº,\" ÌîºÌä∏Í∞Ä ÏÉà Ïï†ÏôÑÎèôÎ¨ºÏóêÍ≤å ÎßêÌï¥Ïöî." },
            { en: "\"You are my first pet,\" Pete tells Goldie on the way home.", ko: "\"ÎÑå ÎÇ¥ Ï≤´ Î≤àÏß∏ Ïï†ÏôÑÎèôÎ¨ºÏù¥Ïïº,\" ÌîºÌä∏Í∞Ä ÏßëÏóê Í∞ÄÎäî Í∏∏Ïóê Í≥®ÎîîÏóêÍ≤å ÎßêÌï¥Ïöî." },
            { en: "Pete takes Goldie to his room.", ko: "ÌîºÌä∏Îäî Í≥®ÎîîÎ•º Î∞©ÏúºÎ°ú Îç∞Î†§Í∞ÄÏöî." },
            { en: "He feeds her fish food.", ko: "Í∑∏Îäî Í∑∏ÎÖÄÏóêÍ≤å Î¨ºÍ≥†Í∏∞ Î∞•ÏùÑ Ï§òÏöî." },
            { en: "\"Now what?\" asks Pete.", ko: "\"Ïù¥Ï†ú Î≠ê ÌïòÏßÄ?\" ÌîºÌä∏Í∞Ä Î¨ºÏñ¥Ïöî." },
            { en: "He can't play with Goldie.", ko: "Í∑∏Îäî Í≥®ÎîîÎûë ÎÜÄ ÏàòÍ∞Ä ÏóÜÏñ¥Ïöî." },
            { en: "He can't swim with her.", ko: "Í∑∏Îäî Í∑∏ÎÖÄÏôÄ ÏàòÏòÅÌï† ÏàòÎèÑ ÏóÜÏñ¥Ïöî." },
            { en: "Pete knows what he can do.", ko: "ÌîºÌä∏Îäî ÏûêÍ∏∞Í∞Ä Î≠ò Ìï† Ïàò ÏûàÎäîÏßÄ ÏïåÏïÑÏöî." },
            { en: "Pete paints a picture of Goldie.", ko: "ÌîºÌä∏Îäî Í≥®ÎîîÏùò Í∑∏Î¶ºÏùÑ Í∑∏Î†§Ïöî." },
            { en: "He paints four fins and an orange tail.", ko: "Í∑∏Îäî ÎÑ§ Í∞úÏùò ÏßÄÎäêÎü¨ÎØ∏ÏôÄ Ï£ºÌô©ÏÉâ Íº¨Î¶¨Î•º Í∑∏Î†§Ïöî." },
            { en: "\"What a pretty painting,‚Äú says Pete's mom.", ko: "\"Ï†ïÎßê ÏòàÏÅú Í∑∏Î¶ºÏù¥Íµ¨ÎÇò,\" ÌîºÌä∏Ïùò ÏóÑÎßàÍ∞Ä ÎßêÌï¥Ïöî." },
            { en: "\"You can keep it,\" says Pete.", ko: "\"ÏóÑÎßà Í∞ÄÏßÄÏÑ∏Ïöî,\" ÌîºÌä∏Í∞Ä ÎßêÌï¥Ïöî." },
            { en: "\"Cool painting!\" says Bob.", ko: "\"Î©ãÏßÑ Í∑∏Î¶ºÏù∏Îç∞!\" Î∞•Ïù¥ ÎßêÌï¥Ïöî." },
            { en: "\"Can you make one for me?\"", ko: "\"ÎÇòÌïúÌÖåÎèÑ ÌïòÎÇò Í∑∏Î†§Ï§Ñ Ïàò ÏûàÏñ¥?\"" },
            { en: "\"Sure,\" says Pete.", ko: "\"Í∑∏Îüº,\" ÌîºÌä∏Í∞Ä ÎßêÌï¥Ïöî." },
            { en: "Pete paints a picture for Bob.", ko: "ÌîºÌä∏Îäî Î∞•ÏùÑ ÏúÑÌï¥ Í∑∏Î¶ºÏùÑ Í∑∏Î†§Ïöî." },
            { en: "\"Wow!\" says Bob.", ko: "\"Ïö∞ÏôÄ!\" Î∞•Ïù¥ ÎßêÌï¥Ïöî." },
            { en: "\"It looks just like Goldie.\"", ko: "\"Í≥®ÎîîÎûë ÎòëÍ∞ôÏù¥ ÏÉùÍ≤ºÎÑ§.\"" },
            { en: "Now everyone in Pete's class wants a painting of Goldie!", ko: "Ïù¥Ï†ú ÌîºÌä∏ÎÑ§ Î∞ò ÏπúÍµ¨Îì§ Î™®ÎëêÍ∞Ä Í≥®Îîî Í∑∏Î¶ºÏùÑ ÏõêÌï¥Ïöî!" },
            { en: "Pete has a lot to do.", ko: "ÌîºÌä∏Îäî Ìï† ÏùºÏù¥ ÎßéÏïÑÏ°åÏñ¥Ïöî." },
            { en: "He makes paintings for everyone on his list.", ko: "Í∑∏Îäî Î™©Î°ùÏóê ÏûàÎäî Î™®ÎëêÎ•º ÏúÑÌï¥ Í∑∏Î¶ºÏùÑ Í∑∏Î†§Ïöî." },
            { en: "At last Pete is done!", ko: "ÎìúÎîîÏñ¥ ÌîºÌä∏Í∞Ä Îã§ ÌñàÏñ¥Ïöî!" },
            { en: "There is no paint left.", ko: "Î¨ºÍ∞êÏù¥ ÌïòÎÇòÎèÑ Ïïà ÎÇ®ÏïòÏñ¥Ïöî." },
            { en: "But Pete is not done.", ko: "ÌïòÏßÄÎßå ÌîºÌä∏Îäî ÎÅùÎÇú Í≤å ÏïÑÎãàÏóêÏöî." },
            { en: "Now everyone in town wants a painting of Goldie!", ko: "Ïù¥Ï†ú ÎßàÏùÑ ÏÇ¨ÎûåÎì§ Î™®ÎëêÍ∞Ä Í≥®Îîî Í∑∏Î¶ºÏùÑ ÏõêÌï¥Ïöî!" },
            { en: "Pete's mom has an idea!", ko: "ÌîºÌä∏Ïùò ÏóÑÎßàÏóêÍ≤å Ï¢ãÏùÄ ÏÉùÍ∞ÅÏù¥ ÎÇ¨Ïñ¥Ïöî!" },
            { en: "Pete works outside and makes a huge painting.", ko: "ÌîºÌä∏Îäî Î∞ñÏóêÏÑú ÏïÑÏ£º Í±∞ÎåÄÌïú Í∑∏Î¶ºÏùÑ ÎßåÎì§Ïñ¥Ïöî." },
            { en: "He has made one painting of Goldie for everyone in town to enjoy!", ko: "Í∑∏Îäî ÎßàÏùÑ ÏÇ¨Îûå Î™®ÎëêÍ∞Ä Ï¶êÍ∏∏ Ïàò ÏûàÎäî Í≥®Îîî Í∑∏Î¶º ÌïòÎÇòÎ•º ÎßåÎì§ÏóàÏñ¥Ïöî!" }
        ];

        // 2. ÌÄ¥Ï¶à Îç∞Ïù¥ÌÑ∞ (10Î¨∏Ï†ú)
        const QUIZ_DATA = [
            { q: "Where is Pete going?", options: ["To school", "To the pet store", "To the park", "To the library"], a: 1 },
            { q: "Which animal did Pete NOT want at first?", options: ["A bird", "A hamster", "A lizard", "A dog"], a: 3 },
            { q: "Which pet does Pete get in the end?", options: ["A goldfish", "A turtle", "A cat", "A parrot"], a: 0 },
            { q: "What does Pete name his pet?", options: ["Fishy", "Goldie", "Shiny", "Orange"], a: 1 },
            { q: "What can't Pete do with Goldie?", options: ["Feed her", "Talk to her", "Play or swim with her", "Look at her"], a: 2 },
            { q: "What does Pete do for Goldie?", options: ["He sings a song", "He paints a picture", "He dances", "He takes her for a walk"], a: 1 },
            { q: "What does Bob say about Pete's painting?", options: ["Strange!", "Scary!", "Cool painting!", "Small!"], a: 2 },
            { q: "What happens after Pete shows the picture at school?", options: ["No one cares", "Everyone wants a painting", "The teacher takes it", "Pete stops painting"], a: 1 },
            { q: "What does Pete do when he runs out of paint?", options: ["Buys more paint", "Stops painting", "Paints one huge painting outside", "Takes a photo"], a: 2 },
            { q: "What is Pete good at in this story?", options: ["Swimming", "Running", "Painting", "Cooking"], a: 2 }
        ];

        // 3. Îã®Ïñ¥ Ïπ¥Îìú Îç∞Ïù¥ÌÑ∞
        const WORD_DATA = [
            { en: "New", desc: "Î∞©Í∏à Îßâ ÏÉùÍ≤®ÎÇú Í≤É", ko: "ÏÉàÎ°úÏö¥", ex: "Pete says to his new pet." },
            { en: "First", desc: "ÏàúÏÑúÍ∞Ä Í∞ÄÏû• ÏïûÏù∏ Í≤É", ko: "Ï≤´ Î≤àÏß∏Ïùò", ex: "You are my first pet." },
            { en: "Orange", desc: "Í∑§Ïù¥ÎÇò Ïò§Î†åÏßÄ Í∞ôÏùÄ ÏÉâÍπî", ko: "Ï£ºÌô©ÏÉâÏùò", ex: "He paints an orange tail." },
            { en: "Pretty", desc: "Î≥¥Í∏∞Ïóê ÏïÑÎ¶ÑÎãµÍ≥† Í≥†Ïö¥ Í≤É", ko: "ÏòàÏÅú", ex: "What a pretty painting!" },
            { en: "Cool", desc: "ÏïÑÏ£º Î©ãÏûàÍ±∞ÎÇò ÏãúÏõêÌïú Í≤É", ko: "Î©ãÏßÑ", ex: "Cool painting! says Bob." },
            { en: "Cute", desc: "ÏûëÍ≥† ÏÇ¨ÎûëÏä§Îü¨Ïö¥ Í≤É", ko: "Í∑ÄÏó¨Ïö¥", ex: "Cute fish!" },
            { en: "Huge", desc: "Î™∏ÏßëÏù¥ ÏïÑÏ£ºÏïÑÏ£º ÌÅ∞ Í≤É", ko: "Í±∞ÎåÄÌïú", ex: "He makes a huge painting." },
            { en: "Real", desc: "Í∞ÄÏßúÍ∞Ä ÏïÑÎãàÍ≥† ÏßÑÏßúÏù∏ Í≤É", ko: "ÏßÑÏßúÏùò", ex: "He tells the real Goldie." },
            { en: "Nice", desc: "Ï∞©ÌïòÍ±∞ÎÇò ÌõåÎ•≠Ìïú Í≤É", ko: "Ï¢ãÏùÄ / Î©ãÏßÑ", ex: "Nice work!" },
            { en: "Big", desc: "ÌÅ¨Í∏∞Í∞Ä ÏóÑÏ≤≠ ÌÅ∞ Í≤É", ko: "ÌÅ∞", ex: "Pete's paintings are a big hit!" },
            { en: "Happy", desc: "Í∏∞Î∂ÑÏù¥ ÏïÑÏ£º Ï¢ãÏùÄ Í≤É", ko: "ÌñâÎ≥µÌïú", ex: "Pete is happy to be done." },
            { en: "Great", desc: "ÎåÄÎã®ÌïòÍ≥† ÌõåÎ•≠Ìïú Í≤É", ko: "ÌõåÎ•≠Ìïú", ex: "What a great day!" }
        ];

        // 4. ÌååÎãâÏä§ Îã®Ïñ¥ ÌíÄ (Î™®ÏùåÎ≥Ñ Îã®Ïñ¥)
        const PHONICS_POOL = {
            a: [
                { type: "Short 'a' /√¶/", list: ["cat", "map", "hat", "dad", "fan"], color: "text-red-500", bg: "bg-red-50" },
                { type: "Long 'a' /e…™/", list: ["cake", "lake", "make", "rain", "play"], color: "text-rose-500", bg: "bg-rose-50" }
            ],
            e: [
                { type: "Short 'e' /…õ/", list: ["bed", "red", "hen", "ten", "pen"], color: "text-green-600", bg: "bg-green-50" },
                { type: "Long 'e' /i:/", list: ["me", "we", "feet", "leaf", "tree"], color: "text-emerald-600", bg: "bg-emerald-50" }
            ],
            i: [
                { type: "Short 'i' /…™/", list: ["fish", "big", "fin", "sit", "kid"], color: "text-sky-600", bg: "bg-sky-50" },
                { type: "Long 'i' /a…™/", list: ["like", "nice", "time", "kite", "bike"], color: "text-blue-600", bg: "bg-blue-50" }
            ],
            o: [
                { type: "Short 'o' /…í/", list: ["got", "mom", "lot", "dog", "box"], color: "text-orange-600", bg: "bg-orange-50" },
                { type: "Long 'o' /o ä/", list: ["go", "no", "home", "gold", "rose"], color: "text-amber-600", bg: "bg-amber-50" }
            ],
            u: [
                { type: "Short 'u' / å/", list: ["bus", "cup", "run", "sun", "bug"], color: "text-purple-600", bg: "bg-purple-50" },
                { type: "Long 'u' /ju:/", list: ["cute", "use", "tube", "mule", "cube"], color: "text-violet-600", bg: "bg-violet-50" }
            ]
        };

        /* ==================================================================================
           ‚ñ≤‚ñ≤‚ñ≤ [Ïó¨Í∏∞ÍπåÏßÄ Îç∞Ïù¥ÌÑ∞Î•º Î∞îÍøîÏ£ºÏÑ∏Ïöî] ‚ñ≤‚ñ≤‚ñ≤
           ================================================================================== */

        // --- ÏïÑÏù¥ÏΩò Ïª¥Ìè¨ÎÑåÌä∏ ---
        const Icon = ({ name, size = 24, className = "" }) => {
            const icons = {
                Book: <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2zM22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />,
                Quiz: <g><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12" y2="17"/></g>,
                Mic: <g><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></g>,
                Card: <g><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></g>,
                Vol: <g><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></g>,
                Refresh: <g><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></g>,
                ArrowR: <g><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></g>,
                ArrowL: <g><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></g>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name]}
                </svg>
            );
        };

        // --- Ïª¥Ìè¨ÎÑåÌä∏ ---
        const StoryTab = ({ accent, speak }) => {
            return (
                <div className="space-y-4 pb-20 animate-fade-in">
                    <div className="flex justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm border border-sky-100">
                        <div>
                            <h2 className="text-xl font-bold text-sky-600 font-fredoka">Let's Read!</h2>
                            <p className="text-xs text-slate-400">Î¨∏Ïû•ÏùÑ ÎàåÎü¨ Îì§Ïñ¥Î≥¥ÏÑ∏Ïöî</p>
                        </div>
                        <button onClick={() => speak(STORY_DATA.map(s => s.en).join(' '))} 
                            className="bg-orange-400 hover:bg-orange-500 text-white p-3 rounded-full shadow-md active:scale-95 transition">
                            <Icon name="Vol" />
                        </button>
                    </div>
                    {STORY_DATA.map((item, idx) => (
                        <div key={idx} onClick={() => speak(item.en)} 
                             className="p-4 bg-white rounded-xl border border-transparent hover:border-sky-300 hover:shadow-md cursor-pointer transition active:bg-sky-50">
                            <p className="text-lg font-medium text-slate-800 mb-2 leading-relaxed font-fredoka">{item.en}</p>
                            <p className="text-slate-500 text-sm korean-font">{item.ko}</p>
                        </div>
                    ))}
                </div>
            );
        };

        const QuizTab = () => {
            const [current, setCurrent] = useState(0);
            const [score, setScore] = useState(0);
            const [selected, setSelected] = useState(null);
            const [finished, setFinished] = useState(false);

            const handleSelect = (idx) => {
                if (selected !== null) return;
                setSelected(idx);
                if (idx === QUIZ_DATA[current].a) setScore(s => s + 1);
            };

            const next = () => {
                if (current < QUIZ_DATA.length - 1) {
                    setCurrent(c => c + 1);
                    setSelected(null);
                } else {
                    setFinished(true);
                }
            };

            const retry = () => {
                setCurrent(0);
                setScore(0);
                setSelected(null);
                setFinished(false);
            };

            if (finished) return (
                <div className="flex flex-col items-center justify-center h-[60vh] animate-pop text-center">
                    <h2 className="text-3xl font-bold text-slate-800 mb-4 font-fredoka">Quiz Complete!</h2>
                    <div className="text-8xl mb-6">üèÜ</div>
                    <p className="text-xl text-slate-600 mb-8 font-fredoka">
                        You scored <span className="text-sky-600 font-bold text-3xl">{score}</span> / {QUIZ_DATA.length}
                    </p>
                    <button onClick={retry} className="bg-sky-500 text-white px-8 py-3 rounded-full font-bold shadow-lg active:scale-95 transition flex items-center gap-2">
                        <Icon name="Refresh" /> Try Again
                    </button>
                </div>
            );

            const q = QUIZ_DATA[current];

            return (
                <div className="pb-20 animate-fade-in max-w-xl mx-auto">
                    <div className="flex justify-between items-center mb-6">
                        <span className="text-xs font-bold text-sky-600 bg-sky-100 px-3 py-1 rounded-full">Question {current + 1} / {QUIZ_DATA.length}</span>
                        <span className="text-xs font-bold text-slate-400">Score: {score}</span>
                    </div>
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-sky-100 mb-6">
                        <h3 className="text-xl font-bold text-slate-800 leading-relaxed font-fredoka">{q.q}</h3>
                    </div>
                    <div className="grid gap-3">
                        {q.options.map((opt, idx) => {
                            let style = "bg-white border-2 border-slate-100 text-slate-600 hover:border-sky-200";
                            let icon = null;
                            if (selected !== null) {
                                if (idx === q.a) { style = "bg-green-50 border-green-400 text-green-700 font-bold"; icon = "‚≠ï"; }
                                else if (idx === selected) { style = "bg-red-50 border-red-300 text-red-700"; icon = "‚ùå"; }
                                else { style = "opacity-50 border-slate-100"; }
                            }
                            return (
                                <button key={idx} onClick={() => handleSelect(idx)} disabled={selected !== null}
                                    className={`p-4 rounded-xl text-left font-fredoka transition-all flex justify-between items-center ${style}`}>
                                    <span>{opt}</span>
                                    {icon && <span>{icon}</span>}
                                </button>
                            );
                        })}
                    </div>
                    <div className="h-16 flex justify-end items-center mt-4">
                        {selected !== null && (
                            <button onClick={next} className="bg-sky-500 text-white px-6 py-3 rounded-xl font-bold shadow-md active:scale-95 transition flex items-center gap-2 animate-pop">
                                {current === QUIZ_DATA.length - 1 ? "See Result" : "Next"} <Icon name="ArrowR" />
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        const PhonicsTab = ({ speak }) => {
            const [selectedVowels, setSelectedVowels] = useState(null);

            const getRandomVowels = useCallback(() => {
                const vowelKeys = Object.keys(PHONICS_POOL);
                const pickedKeys = vowelKeys.sort(() => 0.5 - Math.random()).slice(0, 2);
                
                const result = pickedKeys.map(key => {
                    const group = PHONICS_POOL[key];
                    return group.map(subGroup => ({
                        ...subGroup,
                        list: [...subGroup.list].sort(() => 0.5 - Math.random()).slice(0, 5)
                    }));
                });
                
                setSelectedVowels({ keys: pickedKeys, data: result });
            }, []);

            useEffect(() => {
                getRandomVowels();
            }, [getRandomVowels]);

            if (!selectedVowels) return null;

            return (
                <div className="pb-20 animate-fade-in space-y-8">
                    <div className="flex justify-between items-end mb-2">
                        <div>
                            <h2 className="text-xl font-bold text-slate-700 korean-font">ÏÜåÎ¶¨ ÎπÑÍµêÌïòÍ∏∞</h2>
                            <p className="text-sm text-slate-500 korean-font">ÏïåÌååÎ≤≥ Î™®ÏùåÏùò Îã§ÏñëÌïú ÏÜåÎ¶¨</p>
                        </div>
                        <button onClick={getRandomVowels} className="text-xs bg-slate-200 text-slate-600 px-3 py-2 rounded-lg hover:bg-slate-300 transition flex gap-1 items-center font-bold">
                            <Icon name="Refresh" size={12} /> New Vowels
                        </button>
                    </div>

                    {selectedVowels.keys.map((key, idx) => (
                        <div key={key} className="bg-white p-5 rounded-2xl shadow-sm border border-sky-100">
                            <div className="w-12 h-12 bg-sky-500 text-white rounded-full flex items-center justify-center font-bold text-2xl mb-4 shadow-md mx-auto uppercase">
                                {key}{key}
                            </div>
                            <div className="space-y-4">
                                {selectedVowels.data[idx].map((group, gIdx) => (
                                    <div key={gIdx} className={`${group.bg} p-4 rounded-xl`}>
                                        <h3 className={`font-bold ${group.color} text-sm mb-3 uppercase tracking-wider`}>{group.type}</h3>
                                        <div className="flex flex-wrap gap-2">
                                            {group.list.map(w => (
                                                <button key={w} onClick={() => speak(w)} className="bg-white border border-slate-200 px-3 py-1.5 rounded-lg text-slate-700 font-medium hover:scale-105 active:scale-95 transition flex gap-1 items-center shadow-sm">
                                                    <Icon name="Vol" size={14} className="text-slate-400" /> {w}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    ))}
                </div>
            );
        };

        const CardTab = ({ speak }) => {
            const [shuffledCards, setShuffledCards] = useState([]);
            const [idx, setIdx] = useState(0);
            const [face, setFace] = useState(0);

            useEffect(() => {
                const shuffled = [...WORD_DATA].sort(() => Math.random() - 0.5);
                setShuffledCards(shuffled);
            }, []);

            if (shuffledCards.length === 0) return null;

            const card = shuffledCards[idx];
            const flip = () => setFace((f) => (f + 1) % 3);
            const prev = (e) => { e.stopPropagation(); if(idx > 0) { setIdx(i => i-1); setFace(0); } };
            const next = (e) => { e.stopPropagation(); if(idx < shuffledCards.length - 1) { setIdx(i => i+1); setFace(0); } };

            return (
                <div className="flex flex-col h-[calc(100vh-140px)] justify-center animate-fade-in max-w-sm mx-auto">
                    <div onClick={flip} className="relative flex-1 bg-white rounded-[3rem] shadow-[0_20px_50px_rgba(14,165,233,0.2)] border-8 border-white cursor-pointer active:scale-[0.98] transition-transform overflow-hidden flex flex-col items-center justify-center text-center p-6 mb-8 group">
                        <div className="absolute bottom-0 right-0 w-48 h-48 opacity-10 pointer-events-none transition-opacity group-hover:opacity-20">
                            <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                <path fill="#0EA5E9" d="M40,160 Q30,60 100,60 Q170,60 160,160 Z" /> 
                                <polygon points="45,70 30,20 80,60" fill="#0EA5E9"/>
                                <polygon points="155,70 170,20 120,60" fill="#0EA5E9"/>
                                <circle cx="75" cy="90" r="8" fill="#333"/>
                                <circle cx="125" cy="90" r="8" fill="#333"/>
                                <path d="M100,105 Q100,120 80,120 M100,105 Q100,120 120,120" stroke="#333" strokeWidth="3" fill="none"/>
                            </svg>
                        </div>
                        <div className="absolute top-8 flex gap-2">
                            {[0,1,2].map(i => <div key={i} className={`w-2 h-2 rounded-full transition-colors ${face === i ? 'bg-sky-500' : 'bg-slate-200'}`} />)}
                        </div>
                        <button onClick={(e) => {e.stopPropagation(); speak(card.en);}} className="absolute top-6 right-6 p-3 bg-sky-50 text-sky-500 rounded-full hover:bg-sky-100 transition z-10">
                            <Icon name="Vol" />
                        </button>
                        <div className="z-10 w-full animate-pop">
                            {face === 0 && (
                                <>
                                    <h2 className="text-5xl font-bold text-sky-600 mb-4 font-fredoka tracking-tight">{card.en}</h2>
                                    <p className="text-sky-300 font-bold text-sm uppercase tracking-widest">Tap for Hint</p>
                                </>
                            )}
                            {face === 1 && (
                                <>
                                    <h2 className="text-3xl font-bold text-sky-600 mb-8 font-fredoka opacity-50">{card.en}</h2>
                                    <div className="bg-orange-50 text-orange-500 p-4 rounded-xl font-bold text-xl korean-font border border-orange-100 shadow-sm">
                                        "{card.desc}"
                                    </div>
                                </>
                            )}
                            {face === 2 && (
                                <>
                                    <h2 className="text-4xl font-bold text-pink-500 mb-2 korean-font">{card.ko}</h2>
                                    <p className="text-slate-400 font-fredoka mb-6">{card.en}</p>
                                    <div className="bg-slate-50 text-slate-600 p-4 rounded-xl italic border border-slate-100">
                                        "{card.ex}"
                                    </div>
                                </>
                            )}
                        </div>
                    </div>
                    <div className="flex items-center justify-between px-4">
                        <button onClick={prev} disabled={idx === 0} className="p-4 bg-white text-sky-500 rounded-full shadow-lg disabled:opacity-30 hover:bg-sky-50 transition active:scale-95"><Icon name="ArrowL" /></button>
                        <span className="font-bold text-sky-900 font-fredoka text-lg">{idx + 1} / {shuffledCards.length}</span>
                        <button onClick={next} disabled={idx === shuffledCards.length - 1} className="p-4 bg-sky-500 text-white rounded-full shadow-lg shadow-sky-200 disabled:opacity-30 hover:bg-sky-600 transition active:scale-95"><Icon name="ArrowR" /></button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [tab, setTab] = useState('story');
            const [accent, setAccent] = useState('en-US');
            const [voices, setVoices] = useState([]);

            // Load voices
            useEffect(() => {
                const loadVoices = () => {
                    const available = window.speechSynthesis.getVoices();
                    setVoices(available);
                };
                loadVoices();
                window.speechSynthesis.onvoiceschanged = loadVoices;
            }, []);

            const speak = useCallback((text) => {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.rate = 0.9;

                // Î™®Î∞îÏùº/Î∏åÎùºÏö∞Ï†ÄÎ≥Ñ Ìò∏ÌôòÏÑ±ÏùÑ ÏúÑÌï¥ Ïñ∏Ïñ¥ ÏΩîÎìú Îß§Ïπ≠ Î°úÏßÅ Í∞ïÌôî
                // 1. Ï†ïÌôïÌûà ÏùºÏπòÌïòÎäî Í≤É (en-US vs en_US Îì±Ïùò Ï∞®Ïù¥ Î¨¥Ïãú)
                let targetVoice = voices.find(v => v.lang.replace('_', '-') === accent);

                // 2. Ï†ïÌôïÌïú Îß§Ïπ≠Ïù¥ ÏóÜÏúºÎ©¥ 'Google'Ïù¥ Ìè¨Ìï®Îêú Í≥†ÌíàÏßà Î™©ÏÜåÎ¶¨ Ïö∞ÏÑ† Í≤ÄÏÉâ (Android Îì±)
                if (!targetVoice) {
                    targetVoice = voices.find(v => v.lang.replace('_', '-') === accent && v.name.includes('Google'));
                }

                // 3. Í∑∏ÎûòÎèÑ ÏóÜÏúºÎ©¥ ÏßÄÏó≠ ÏΩîÎìú(US, GB, AU)Í∞Ä Ìè¨Ìï®Îêú Í≤É Í≤ÄÏÉâ
                if (!targetVoice) {
                    const region = accent.split('-')[1]; // US, GB, AU
                    targetVoice = voices.find(v => v.lang.toUpperCase().includes(region));
                }

                // 4. ÏµúÌõÑÏùò ÏàòÎã®: Ïñ∏Ïñ¥(en)Í∞Ä Í∞ôÏùÄ ÏïÑÎ¨¥ Î™©ÏÜåÎ¶¨
                if (!targetVoice) {
                    targetVoice = voices.find(v => v.lang.startsWith(accent.split('-')[0]));
                }

                if (targetVoice) {
                    u.voice = targetVoice;
                    u.lang = targetVoice.lang;
                } else {
                    u.lang = accent;
                }
                
                window.speechSynthesis.speak(u);
            }, [accent, voices]);

            const TABS = [
                { id: 'story', label: 'Story', icon: 'Book' },
                { id: 'quiz', label: 'Quiz', icon: 'Quiz' },
                { id: 'phonics', label: 'Phonics', icon: 'Mic' },
                { id: 'cards', label: 'Cards', icon: 'Card' },
            ];

            return (
                <div className="max-w-2xl mx-auto min-h-screen flex flex-col bg-sky-50">
                    <div className="bg-white/80 backdrop-blur-md sticky top-0 z-50 px-4 py-3 shadow-sm border-b border-sky-100">
                        <div className="flex justify-between items-center mb-3">
                            <h1 className="text-2xl font-bold text-sky-500 flex items-center gap-2 font-fredoka">
                                <Icon name="Book" /> Pete's Class
                            </h1>
                            <select value={accent} onChange={e => setAccent(e.target.value)} className="text-xs bg-slate-100 px-2 py-1 rounded-md font-bold text-slate-500 outline-none">
                                <option value="en-US">üá∫üá∏ US</option>
                                <option value="en-GB">üá¨üáß UK</option>
                                <option value="en-AU">üá¶üá∫ AU</option>
                            </select>
                        </div>
                        <div className="flex gap-1 bg-sky-100/50 p-1 rounded-xl overflow-x-auto hide-scrollbar">
                            {TABS.map(t => (
                                <button key={t.id} onClick={() => setTab(t.id)}
                                    className={`flex-1 py-2 px-3 rounded-lg flex items-center justify-center gap-1.5 text-xs font-bold transition-all whitespace-nowrap
                                    ${tab === t.id ? 'bg-sky-500 text-white shadow-sm' : 'text-sky-600 hover:bg-sky-200/50'}`}>
                                    <Icon name={t.icon} size={16} /> {t.label}
                                </button>
                            ))}
                        </div>
                    </div>
                    <div className="flex-1 p-4 overflow-y-auto">
                        {tab === 'story' && <StoryTab accent={accent} speak={speak} />}
                        {tab === 'quiz' && <QuizTab />}
                        {tab === 'phonics' && <PhonicsTab speak={speak} />}
                        {tab === 'cards' && <CardTab speak={speak} />}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
